



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Data Replication in context of Kafka and Event Streams</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduction" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="Data Replication in context of Kafka and Event Streams" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Data Replication in context of Kafka and Event Streams
            </span>
            <span class="md-header-nav__topic">
              Introduction
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/jbcodeforce/kp-data-replication.git/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="." title="Data Replication in context of Kafka and Event Streams" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Data Replication in context of Kafka and Event Streams
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/jbcodeforce/kp-data-replication.git/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Introduction
      </label>
    
    <a href="." title="Introduction" class="md-nav__link md-nav__link--active">
      Introduction
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mirror-maker-20" title="Mirror Maker 2.0" class="md-nav__link">
    Mirror Maker 2.0
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-concepts" title="General concepts" class="md-nav__link">
    General concepts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements-to-address" title="Requirements to address" class="md-nav__link">
    Requirements to address
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environments" title="Environments" class="md-nav__link">
    Environments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-cluster-to-event-streams-on-cloud" title="Local cluster to Event Streams on Cloud" class="md-nav__link">
    Local cluster to Event Streams on Cloud
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provisioning-connectors-mirror-maker-2" title="Provisioning Connectors (Mirror Maker 2)" class="md-nav__link">
    Provisioning Connectors (Mirror Maker 2)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-to-version-migration" title="Version to version migration" class="md-nav__link">
    Version to version migration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security" title="Security" class="md-nav__link">
    Security
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring" title="Monitoring" class="md-nav__link">
    Monitoring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-tests" title="Performance  tests" class="md-nav__link">
    Performance  tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Environment provisioning
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Environment provisioning
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="dc-local/" title="Run local kafka cluster with docker compose" class="md-nav__link">
      Run local kafka cluster with docker compose
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="provisioning/" title="Strimzi Kafka 2.4 Provisioning on Openshift" class="md-nav__link">
      Strimzi Kafka 2.4 Provisioning on Openshift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="mm2-provisioning/" title="Mirror Maker 2 Provisioning" class="md-nav__link">
      Mirror Maker 2 Provisioning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Replication Scenarios
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Replication Scenarios
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="local-to-es/" title="Replication from local to Event Streams" class="md-nav__link">
      Replication from local to Event Streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="es-to-local/" title="Replication from Event Streams to local" class="md-nav__link">
      Replication from Event Streams to local
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="es-prem-to-es/" title="From Event Streams on OpenShift to Event Streams on Cloud" class="md-nav__link">
      From Event Streams on OpenShift to Event Streams on Cloud
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Best practices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Best practices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/readme" title="Kafka Summary" class="md-nav__link">
      Kafka Summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/consumers" title="Consumer practices" class="md-nav__link">
      Consumer practices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/producers" title="Producer practices" class="md-nav__link">
      Producer practices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/connect" title="Kafka Connect" class="md-nav__link">
      Kafka Connect
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="consideration/" title="Replicaton considerations" class="md-nav__link">
      Replicaton considerations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Operations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Operations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="monitoring/" title="Monitoring with Prometheus and Grafana" class="md-nav__link">
      Monitoring with Prometheus and Grafana
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="perf-tests/" title="Tests" class="md-nav__link">
      Tests
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="compendium/" title="Compendium" class="md-nav__link">
      Compendium
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mirror-maker-20" title="Mirror Maker 2.0" class="md-nav__link">
    Mirror Maker 2.0
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-concepts" title="General concepts" class="md-nav__link">
    General concepts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements-to-address" title="Requirements to address" class="md-nav__link">
    Requirements to address
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environments" title="Environments" class="md-nav__link">
    Environments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-cluster-to-event-streams-on-cloud" title="Local cluster to Event Streams on Cloud" class="md-nav__link">
    Local cluster to Event Streams on Cloud
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provisioning-connectors-mirror-maker-2" title="Provisioning Connectors (Mirror Maker 2)" class="md-nav__link">
    Provisioning Connectors (Mirror Maker 2)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-to-version-migration" title="Version to version migration" class="md-nav__link">
    Version to version migration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security" title="Security" class="md-nav__link">
    Security
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring" title="Monitoring" class="md-nav__link">
    Monitoring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" title="Best Practices" class="md-nav__link">
    Best Practices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-tests" title="Performance  tests" class="md-nav__link">
    Performance  tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jbcodeforce/kp-data-replication.git/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="introduction">Introduction</h1>
<p>This repository includes a set of documents for best practices around data replication between two Kafka clusters.</p>
<h2 id="mirror-maker-20">Mirror Maker 2.0</h2>
<p>Mirror Maker 2.0 is the new replication feature of Kafka 2.4. It was defined as part of the <a href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-382%3A+MirrorMaker+2.0">KIP 382</a>.</p>
<h3 id="general-concepts">General concepts</h3>
<p>As <a href="https://strimzi.io/docs/master/#con-configuring-mirror-maker-deployment-configuration-kafka-mirror-maker">Mirror maker 2.0</a> is using kafka Connect framework, we recommend to review our summary <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/connect/">in this note</a>.</p>
<p>The figure below illustrates the mirror maker internal components running within Kafka Connect.</p>
<p><img alt="Kafka Connect" src="images/mm-k-connect.png" /></p>
<p>In distributed mode, Mirror Maker creates the following topics to the target cluster:</p>
<ul>
<li>mm2-configs.source.internal: This topic will store the connector and task configurations.</li>
<li>mm2-offsets.source.internal: This topic is used to store offsets for Kafka Connect.</li>
<li>mm2-status.source.internal: This topic will store status updates of connectors and tasks.</li>
<li>source.heartbeats</li>
<li>source.checkpoints.internal</li>
</ul>
<p>A typical mirror maker configuration is done via property file and defines source and target clusters with their connection properties and the replication flow definitions. Here is a simple example for a local cluster to a target cluster using TLS v1.2 for connection encryption and Sasl authentication protocol to connect to Event Streams.</p>
<div class="codehilite"><pre><span></span><span class="na">clusters</span><span class="o">=</span><span class="s">source, target</span>
<span class="na">source.bootstrap.servers</span><span class="o">=</span><span class="s">${KAFKA_SOURCE_BROKERS}</span>
<span class="na">target.bootstrap.servers</span><span class="o">=</span><span class="s">${KAFKA_TARGET_BROKERS}</span>
<span class="na">target.security.protocol</span><span class="o">=</span><span class="s">SASL_SSL</span>
<span class="na">target.ssl.protocol</span><span class="o">=</span><span class="s">TLSv1.2</span>
<span class="na">target.ssl.endpoint.identification.algorithm</span><span class="o">=</span><span class="s">https</span>
<span class="na">target.sasl.mechanism</span><span class="o">=</span><span class="s">PLAIN</span>
<span class="na">target.sasl.jaas.config</span><span class="o">=</span><span class="s">org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;token&quot; password=${KAFKA_TARGET_APIKEY};</span>
<span class="c"># enable and configure individual replication flows</span>
<span class="na">source-&gt;target.enabled</span><span class="o">=</span><span class="s">true</span>
<span class="na">source-&gt;target.topics</span><span class="o">=</span><span class="s">products</span>
<span class="na">tasks.max</span><span class="o">=</span><span class="s">10</span>
</pre></div>

<ul>
<li>White listed topics are set with the <code>source-&gt;target.topics</code> attribute of the replication flow and uses <a href="https://www.vogella.com/tutorials/JavaRegularExpressions/article.html">Java regular expression</a> syntax.</li>
<li>Blacklisted topics: by default the following pattern is applied:</li>
</ul>
<div class="codehilite"><pre><span></span><span class="na">blacklist</span> <span class="o">=</span> <span class="s">[follower\.replication\.throttled\.replicas, leader\.replication\.throttled\.replicas, message\.timestamp\.difference\.max\.ms, message\.timestamp\.type, unclean\.leader\.election\.enable, min\.insync\.replicas]</span>
</pre></div>

<p>But we can also define the samethings with the properties: <code>topics.blacklist</code>. Comma-separated lists are also supported and Java regular expression.</p>
<p>Internally <code>MirrorSourceConnector</code> and <code>MirrorCheckpointConnector</code> will create multiple tasks (up to <code>tasks.max</code> property), <code>MirrorHeartbeatConnector</code>
creates only one single task. <code>MirrorSourceConnector</code> will have one task per topic-partition to replicate, while <code>MirrorCheckpointConnector</code> will have one task per consumer group. The Kafka connect framework uses the coordinator API, with the <code>assign()</code> API, so there is no consumer group while fetching data from source topic. There is no call to <code>commit()</code> neither: the rebalancing occurs only when there is a new topic created that matches the whitelist pattern.</p>
<h2 id="requirements-to-address">Requirements to address</h2>
<h3 id="environments">Environments</h3>
<p>We propose two approaches to run the 'on-premise' Kafka cluster:</p>
<ul>
<li><a href="#scenario-1-from-kafka-local-as-source-to-event-streams-on-cloud-as-target">Docker compose using vanilla Kafka 2.4</a>: To run local cluster we use docker-compose and docker. The docker compose file to start a local 3 Kafka brokers and 2 Zookeepers cluster is in <code>mirror-maker-2/local-cluster</code> folder. This compose file uses a local docker network called <code>kafkanet</code>. The docker image used for Kafka is coming from Strimzi open source project and is for the Kafka 2.4 version. We are describing how to setup this simple cluster using <a href="dc-local/">Docker compose in this article</a>.</li>
<li><a href="#scenario-2-run-mirror-maker-2-cluster-close-to-target-cluster">Kafka 2.4 cluster using Strimzi operator deployed on Openshift</a></li>
</ul>
<p>For the Event Streams on Cloud cluster, we recommend to create your own using IBM Cloud Account. The product <a href="https://cloud.ibm.com/registration?target=catalog/services/event-streams">documentation is here</a>.</p>
<p>The enviroments can be summarized in the table below:</p>
<table>
<thead>
<tr>
<th>Environment</th>
<th>Source</th>
<th>Target</th>
<th align="center">Connect</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Local</td>
<td>Event Streams on Cloud</td>
<td align="center">Local</td>
</tr>
<tr>
<td>2</td>
<td>Strimzi on OCP</td>
<td>Event Streams on Cloud</td>
<td align="center">OCP / Roks</td>
</tr>
<tr>
<td>3</td>
<td>Event Streams on Cloud</td>
<td>Local</td>
<td align="center">Local</td>
</tr>
<tr>
<td>4</td>
<td>Event Streams on Cloud</td>
<td>Strimzi on OCP</td>
<td align="center">OCP/ Roks</td>
</tr>
<tr>
<td>5</td>
<td>Event Streams on OCP</td>
<td>Event Streams on Cloud</td>
<td align="center">OCP / Roks</td>
</tr>
</tbody>
</table>
<h3 id="local-cluster-to-event-streams-on-cloud">Local cluster to Event Streams on Cloud</h3>
<p>The goal is to demonstrate the replicate data from local cluster to Event Streams on IBM Cloud running as managed service. The two scenarios and the step by step approach are presented in <a href="local-to-es/">this note</a>.</p>
<p>We have documented the replication from Event Streams as a Service to local cluster in <a href="es-to-local/">this note</a> with two scenarios depending of the target Kafka cluster (running on OpenShift or on VM / containers).</p>
<h3 id="provisioning-connectors-mirror-maker-2">Provisioning Connectors (Mirror Maker 2)</h3>
<p>This main epic is related to provisioning operation.</p>
<ol>
<li>
<p>As a SRE I want to provision and deploy Mirror Maker 2 connector to existing Openshift cluster without exposing password and keys so replication can start working. This will use Kubernetes secrets for configuration parameters.</p>
<ul>
<li>We are describing the MM2 deployment with secrets in <a href="mm2-provisioning/#deploying-using-strimzi-mirror-maker-operator">this section</a>.</li>
</ul>
</li>
<li>
<p>As a SRE I want to understand the CLI commands used to assess to assess how the provisioning process can be automated.</p>
<ul>
<li>We did not proof how to automate the deployment, but as all deployments are done with CLI and configuration files we could <a href="mm2-provisioning#provisioning-automation">consider using Ansible</a> for automation. </li>
</ul>
</li>
<li>
<p>As a SRE I want to understand the server sizing for the Mirror Maker environment so that I can understand how to use leanest resources for minimal needs.</p>
<ul>
<li>We talk about capacity planning in <a href="mm2-provisioning#capacity-planning">this section</a> and performance tests <a href="perf-tests">in a separate note</a>.</li>
</ul>
</li>
</ol>
<p><em>Note that, there is no specific user interface for mirror maker connector.</em></p>
<h3 id="version-to-version-migration">Version to version migration</h3>
<ol>
<li>
<p>As a SRE, I want to understand how to perform a version to version migration for the Mirror Maker 2 product so that existing streaming replication is not impacted by the upgrade.</p>
<ul>
<li>See some rolling upgrade recommendations in <a href="mm2-provisioning#version-migration">this section</a>.</li>
</ul>
</li>
<li>
<p>As a developer I want to deploy configuration updates to modify the topic white or black lists so that newly added topics are replicated.</p>
<ul>
<li>Mirror maker 2 configuration is done with yaml files and applied using <code>kubectl or oc</code> CLI. The Strimzi cluster operator is managing the redeployment of the mirror maker deployment.</li>
</ul>
</li>
</ol>
<h3 id="security">Security</h3>
<ol>
<li>
<p>As a SRE, I want to understand how client applications authenticate to source and target clusters.</p>
</li>
<li>
<p>As a developer I want to design Mirror Maker 2 based replication solution to support different line of businesses who should not connect to topics and data not related to their business and security scope.</p>
</li>
</ol>
<p>Those subjects are addressed in <a href="security/">the security note</a>.</p>
<h3 id="monitoring">Monitoring</h3>
<ol>
<li>
<p>As a SRE, I want to get Mirror Maker 2 metrics for Prometheus so that it fits in my current metrics processing practices.</p>
<ul>
<li>The explanation to setup Prometheus metris for mirror maker 2.0 is documented <a href="monitoring/">in the monitoring note</a>.</li>
</ul>
</li>
<li>
<p>As a SRE, I want to be able to add new dashboard into Grafana to visualize the Mirror Maker 2 metrics.</p>
</li>
<li>
<p>As a SRE, I want to define rules for alert reporting and configure a Slack channel for alerting.</p>
</li>
<li>
<p>[Removed] As a SRE, I want to get the Mirror Maker 2 logs into our Splunk logging platform.</p>
</li>
</ol>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li>
<p>As a developer I want to understand how Mirror Maker 2 based replication addresses the record duplication.</p>
<ul>
<li>Here is <a href="consideration#record-duplication">a note on records duplication</a>.</li>
</ul>
</li>
<li>
<p>As a developer I want to design replication solution to minimize the instance of Mirror Maker or being able to scale them if I observe lag into data replication processing.</p>
<ul>
<li>Lags will be present anyway dues to the asynchronous processing, but it is possible to scale vertically and horizontally.</li>
</ul>
</li>
<li>
<p>As a developer I want to understand what are the conditions for message loss. We are detailing the exactly once and ensuring delivery in <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/producers#how-to-support-exactly-once-delivery">those notes: producer</a> and <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/consumers">consumer</a>.</p>
</li>
</ol>
<h3 id="performance-tests">Performance  tests</h3>
<ol>
<li>
<p>As a developer I want to understand how to measure data latency and lag in data replication.</p>
<ul>
<li>IBM Event streams offers an event producers to do stress testing. The performance tests are documented <a href="perf-tests/">in this chapter</a>.</li>
</ul>
</li>
<li>
<p>As a SRE I want to understand current throughput for the replication solution.</p>
<ul>
<li>Kafka brokers are reporting the number of request per second, and the byte in per sec as part of the metrics visible in Prometheus. Those metrics can be at the producer Fetch consumer or fetch follower level.</li>
</ul>
</li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="dc-local/" title="Run local kafka cluster with docker compose" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Run local kafka cluster with docker compose
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>