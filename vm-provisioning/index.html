



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>VM MirrorMaker 2 provisioning - Data Replication in context of Kafka and Event Streams</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#standalone-vm-based-installation-of-mirrormaker-2" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Data Replication in context of Kafka and Event Streams" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Data Replication in context of Kafka and Event Streams
            </span>
            <span class="md-header-nav__topic">
              VM MirrorMaker 2 provisioning
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/jbcodeforce/kp-data-replication.git/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Data Replication in context of Kafka and Event Streams" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Data Replication in context of Kafka and Event Streams
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/jbcodeforce/kp-data-replication.git/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Environment provisioning
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Environment provisioning
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../dc-local/" title="Run local kafka cluster with docker compose" class="md-nav__link">
      Run local kafka cluster with docker compose
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../provisioning/" title="Strimzi Kafka 2.4 Provisioning on Openshift" class="md-nav__link">
      Strimzi Kafka 2.4 Provisioning on Openshift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mm2-provisioning/" title="MirrorMaker 2 Provisioning" class="md-nav__link">
      MirrorMaker 2 Provisioning
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        VM MirrorMaker 2 provisioning
      </label>
    
    <a href="./" title="VM MirrorMaker 2 provisioning" class="md-nav__link md-nav__link--active">
      VM MirrorMaker 2 provisioning
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#environment" title="Environment" class="md-nav__link">
    Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restarting-mirrormaker-2" title="Restarting MirrorMaker 2" class="md-nav__link">
    Restarting MirrorMaker 2
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ocp42.cloudpak8s.io/integration/cp4i-install/" title="Cloud Pak for integration provisioning" class="md-nav__link">
      Cloud Pak for integration provisioning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Replication Scenarios
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Replication Scenarios
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../local-to-es/" title="Replication from local to Event Streams" class="md-nav__link">
      Replication from local to Event Streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../es-to-local/" title="Replication from Event Streams to local" class="md-nav__link">
      Replication from Event Streams to local
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../es-prem-to-es/" title="From Event Streams on OpenShift to Event Streams on Cloud" class="md-nav__link">
      From Event Streams on OpenShift to Event Streams on Cloud
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Best practices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Best practices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/readme" title="Kafka Summary" class="md-nav__link">
      Kafka Summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/technology/kafka-producers-consumers/#kafka-consumers" title="Consumer practices" class="md-nav__link">
      Consumer practices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/technology/kafka-producers-consumers/#kafka-producers" title="Producer practices" class="md-nav__link">
      Producer practices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/connect" title="Kafka Connect" class="md-nav__link">
      Kafka Connect
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../consideration/" title="Replicaton considerations" class="md-nav__link">
      Replicaton considerations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Operations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Operations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../monitoring/" title="Monitoring with Prometheus and Grafana" class="md-nav__link">
      Monitoring with Prometheus and Grafana
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../perf-tests/" title="Tests" class="md-nav__link">
      Tests
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../compendium/" title="Compendium" class="md-nav__link">
      Compendium
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#environment" title="Environment" class="md-nav__link">
    Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restarting-mirrormaker-2" title="Restarting MirrorMaker 2" class="md-nav__link">
    Restarting MirrorMaker 2
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jbcodeforce/kp-data-replication.git/edit/master/docs/vm-provisioning.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="standalone-vm-based-installation-of-mirrormaker-2">Standalone VM Based Installation of MirrorMaker 2</h1>
<p>Here we are showing how to install and configure Kafka MirrorMaker 2 in a cluster on VMs.  We will also show how to test the MirrorMaker 2 cluster for resiliency, and finally how to perform a rolling upgrade of the MirrorMaker 2 nodes.</p>
<h2 id="environment">Environment</h2>
<p>The environment we’re using is as follows:</p>
<ul>
<li>A remote IBM Event Streams cluster on IBM Cloud as the source cluster</li>
<li>A local Kafka 2.4 cluster deployed on OpenShift using the Strimzi v0.17 Operator</li>
<li>2x dedicated Linux VMs for running a clustered pair of MirrorMaker 2 nodes</li>
<li>A dedicated Linux VM to act as a data stream producer</li>
<li>A dedicated Linux VM to act as a data stream consumer</li>
<li>Java VMs are already installed on all VMs</li>
<li>On the Producer VM, we use a simple producer sample provided by IBM for use with Event Streams:  <a href="https://github.com/ibm-messaging/event-streams-samples">https://github.com/ibm-messaging/event-streams-samples</a></li>
<li>On the Consumer VM and MirrorMaker VMs, we use the Client and Cluster Certificates from the Kafka cluster merged into a PKCS 12 format certificate file.  </li>
</ul>
<p>First, start the producer to start sending data to the remote Event Streams cluster.  On the Producer VM, start streaming data to Event Streams:</p>
<p><img alt="" src="../images/vm-1.png" /></p>
<p>Note the specific brokers and the authentication token used have been blacked-out.  We’ll let this producer run in the background producing one message per second.</p>
<p>Next we’ll set up the first MirrorMaker 2 node.  To install MirrorMaker, we’re just downloading the Kafka 2.4 distribution from Apache directly:  <a href="https://www.apache.org/dyn/closer.cgi?path=/kafka/2.4.1/kafka_2.12-2.4.1.tgz">https://www.apache.org/dyn/closer.cgi?path=/kafka/2.4.1/kafka_2.12-2.4.1.tgz</a></p>
<p>We’ll untar the archive into /opt and create a symlink.  Also, set the PATH to include the new Kafka package.</p>
<p><img alt="" src="../images/vm-2.png" /></p>
<p>Now we will create a MirrorMaker 2 configuration file based on the sample provided in /opt/kafka/config/connect-mirror-maker.properties and add some options.  The full configuration is below:</p>
<div class="codehilite"><pre><span></span><span class="c"># Run with ./bin/connect-mirror-maker.sh connect-mirror-maker.properties </span>

<span class="c"># specify any number of cluster aliases</span>
<span class="na">clusters</span> <span class="o">=</span> <span class="s">kp-remote,kp-local</span>

<span class="c"># connection information for each cluster</span>
<span class="c"># This is a comma separated host:port pairs for each cluster</span>
<span class="c"># for e.g. &quot;A_host1:9092, A_host2:9092, A_host3:9092&quot;</span>

<span class="c">#</span>
<span class="c"># KP Remote Cluster</span>
<span class="c"># IES on IBM Cloud</span>
<span class="c">#</span>

<span class="na">kp-remote.bootstrap.servers</span> <span class="o">=</span> <span class="s">broker-3 ... eventstreams.cloud.ibm.com:9093</span>
<span class="na">kp-remote.ssl.enabled.protocols</span><span class="o">=</span><span class="s">TLSv1.2</span>
<span class="na">kp-remote.ssl.protocol</span><span class="o">=</span><span class="s">TLS</span>
<span class="na">kp-remote.security.protocol</span><span class="o">=</span><span class="s">SASL_SSL</span>
<span class="na">kp-remote.sasl.mechanism</span><span class="o">=</span><span class="s">PLAIN</span>
<span class="na">kp-remote.sasl.jaas.config</span><span class="o">=</span><span class="s">org.apache.kafka.common.security.plain.PlainLoginModule  required \</span>
<span class="s">  username=&quot;token&quot; \</span>
<span class="s">  password=&quot;hCJ ... KtS&quot;;</span>

<span class="c">#</span>
<span class="c"># KP Local Cluster</span>
<span class="c"># Kafka 2.4 on OpenShift using Strimzi 0.17 Operator</span>
<span class="c">#</span>

<span class="na">kp-local.bootstrap.servers</span> <span class="o">=</span> <span class="s">kp-local-kafka-bootstrap-kp-local-kafka.apps. ... :443</span>
<span class="na">kp-local.ssl.enabled.protocols</span><span class="o">=</span><span class="s">TLSv1.2</span>
<span class="na">kp-local.ssl.protocol</span><span class="o">=</span><span class="s">TLS</span>
<span class="na">kp-local.security.protocol</span><span class="o">=</span><span class="s">SSL</span>
<span class="na">kp-local.ssl.truststore.location</span> <span class="o">=</span> <span class="s">truststore.p12</span>
<span class="na">kp-local.ssl.truststore.password</span> <span class="o">=</span> <span class="s">cz ... Hi</span>
<span class="na">kp-remote-&gt;kp-local.tasks.max</span> <span class="o">=</span> <span class="s">3</span>
<span class="na">kp-remote-&gt;kp-local.group.id</span><span class="o">=</span><span class="s">mirrormaker2-cluster</span>

<span class="c"># enable and configure individual replication flows</span>
<span class="na">kp-remote-&gt;kp-local.enabled</span> <span class="o">=</span> <span class="s">true</span>
<span class="c"># regex which defines which topics gets replicated. For eg &quot;foo-.*&quot;</span>
<span class="na">kp-remote-&gt;kp-local.topics</span> <span class="o">=</span> <span class="s">.*</span>
<span class="c"># Setting replication factor of newly created remote topics</span>
<span class="na">replication.factor</span><span class="o">=</span><span class="s">3</span>
<span class="c">############################# Internal Topic Settings  #############################</span>
<span class="c"># The replication factor for mm2 internal topics &quot;heartbeats&quot;, &quot;B.checkpoints.internal&quot; and</span>
<span class="c"># &quot;mm2-offset-syncs.B.internal&quot;</span>
<span class="c"># For anything other than development testing, a value greater than 1 is recommended to ensure availability such as 3.</span>
<span class="na">checkpoints.topic.replication.factor</span><span class="o">=</span><span class="s">3</span>
<span class="na">heartbeats.topic.replication.factor</span><span class="o">=</span><span class="s">3</span>
<span class="na">offset-syncs.topic.replication.factor</span><span class="o">=</span><span class="s">3</span>

<span class="c"># The replication factor for connect internal topics &quot;mm2-configs.B.internal&quot;, &quot;mm2-offsets.B.internal&quot; and</span>
<span class="c"># &quot;mm2-status.B.internal&quot;</span>
<span class="c"># For anything other than development testing, a value greater than 1 is recommended to ensure availability such as 3.</span>
<span class="na">offset.storage.replication.factor</span><span class="o">=</span><span class="s">3</span>
<span class="na">status.storage.replication.factor</span><span class="o">=</span><span class="s">3</span>
<span class="na">config.storage.replication.factor</span><span class="o">=</span><span class="s">3</span>

<span class="c"># customize as needed</span>
<span class="c"># replication.policy.separator = _</span>
<span class="na">sync.topic.acls.enabled</span> <span class="o">=</span> <span class="s">false</span>
<span class="c"># emit.heartbeats.interval.seconds = 5</span>
</pre></div>

<p>Note that passwords and API keys have been obscured as well as hostnames.  This configuration file, along with the trust store for connecting to our local Kafka cluster, is all that is needed to replicate topics from the remote EventStreams cluster to the local Kafka cluster.  We start the MirrorMaker 2 cluster and wait for it to finish initializing:</p>
<div class="codehilite"><pre><span></span>./bin/connect-mirror-maker.sh mm2.properties
</pre></div>

<p>Once it finishes initializing, we should see messages like the following:</p>
<p><img alt="" src="../images/vm-3.png" /></p>
<p>To show that replication is occurring, we will create a consumer on the Consumer VM.  Install Kafka as shown above and use the built-in console consumer to view the replicated messages from the local Kafka cluster.   To run the consumer, we use the same PKCS 12 certificate file to authenticate to the local cluster, and a local-consumer.properties file that is shown below:</p>
<p><div class="codehilite"><pre><span></span><span class="na">client.id</span><span class="o">=</span><span class="s">test-consumer-1</span>
<span class="na">ssl.enabled.protocols</span><span class="o">=</span><span class="s">TLSv1.2</span>
<span class="na">security.protocol</span><span class="o">=</span><span class="s">SSL</span>
<span class="na">ssl.protocol</span><span class="o">=</span><span class="s">TLS</span>
<span class="na">ssl.truststore.location</span><span class="o">=</span><span class="s">truststore.p12</span>
<span class="na">ssl.truststore.password</span><span class="o">=</span><span class="s">cz...</span>
</pre></div>
Run the consumer command:</p>
<p><img alt="" src="../images/vm-4.png" /></p>
<p>Notice that the topic name in this case is <code>kp-remote.kp-topic-1</code> instead of just <code>kp-topic-1</code>.  This is because we’re monitoring the replicated version of <code>kp-topic-1</code> from the remote EventStreams cluster.  MirrorMaker 2 automatically prepends the alias of the remote cluster as it is labeled in the MirrorMaker 2 configuration file.  In this case, the alias was <code>kp-remote</code>, so the replicated topic <code>kp-topic-1</code> is named <code>kp-remote.kp-topic-1</code>.</p>
<p>We can see the test messages from the producer that is writing to EventStreams are being replicated successfully to our local Kafka cluster.</p>
<div class="codehilite"><pre><span></span>./bin/connect-mirror-maker.sh mm2.properties
</pre></div>

<h2 id="restarting-mirrormaker-2">Restarting MirrorMaker 2</h2>
<p>Now that replication is running successfully and we have both a producer and consumer running to view the traffic in real time, we can set up a second MirrorMaker 2 node.  The process is exactly the same as the first MirrorMaker 2 node, and the configuration file is also exactly the same.</p>
<p>Now that both instances of MirrorMaker 2 are running, we can verify that both instances are able to assume the load by stopping the first MirrorMaker 2 instance we created, verifying that replication is still occurring, restarting it, and finally stopping the second instance.  This will show that as long as at least one instance of MirrorMaker 2 is running we have successful replication.</p>
<p>From the Consumer:</p>
<p><img alt="" src="../images/vm-5.png" /></p>
<p>Now we stop the first MirrorMaker 2, and verify that replication is still occurring via the Consumer VM: </p>
<p><img alt="" src="../images/vm-6.png" /></p>
<p>Replication continued as expected.  Now we restart MirrorMaker 2 on Node 1, and stop it on Node 2, and check the consumer is still getting records.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../mm2-provisioning/" title="MirrorMaker 2 Provisioning" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                MirrorMaker 2 Provisioning
              </span>
            </div>
          </a>
        
        
          <a href="../local-to-es/" title="Replication from local to Event Streams" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Replication from local to Event Streams
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>